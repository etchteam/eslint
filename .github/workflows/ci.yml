---
name: üëÆ CI
on: pull_request
env:
  HUSKY: 0
permissions:
  contents: read
jobs:
  lint:
    strategy:
      matrix:
        version: [20, 22, 24]
    name: üßπ Lint
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd
      - uses: actions/setup-node@6044e13b5dc448c55e2357c09f80417699197238
        with:
          node-version: ${{ matrix.version }}
          cache: npm
      - run: npm ci --no-audit --no-fund --prefer-offline
      - run: npx --no-install eslint src
  test:
    strategy:
      matrix:
        version: [20, 22, 24]
    name: üß™ Test
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd
      - uses: actions/setup-node@6044e13b5dc448c55e2357c09f80417699197238
        with:
          node-version: ${{ matrix.version }}
          cache: npm
      - run: npm ci --no-audit --no-fund --prefer-offline
      - name: Test configs expect ESLint violations
        run: |
          # Helper function to test that ESLint finds violations
          test_config() {
            local name="$1"
            local path="$2"
            set +e
            npx eslint $path
            local exit_code=$?
            set -e
            if [ $exit_code -eq 0 ]; then
              echo "‚ùå $name test files should have ESLint violations but none were found"
              return 1
            fi
            echo "‚úÖ $name test files correctly show ESLint violations"
          }

          # Test all configs
          test_config "Base" "test-files/test.js test-files/test.json test-files/test.yml" && \
          test_config "Angular" "test-files/angular/" && \
          test_config "NestJS" "test-files/nestjs/" && \
          test_config "Next.js" "test-files/nextjs/" && \
          test_config "Node.js" "test-files/nodejs/" && \
          test_config "Preact" "test-files/preact/" && \
          test_config "Web Components" "test-files/web-components/"
